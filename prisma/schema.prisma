generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model GuildConfig {
  id               String  @id @default(cuid())
  guildId          String  @unique
  statusChannelId  String?
  updateChannelId  String?
  logChannelId     String? // For ticket transcripts, etc.
  statusInterval   Int     @default(120) // in seconds
  onlineMessage    String  @default("ðŸŸ¢ Server is UP! {players}/{max} survivors.")
  offlineMessage   String  @default("ðŸ”´ Server is currently offline.")
  serverIp         String? // Project Zomboid Server IP
  serverPort       Int?    // Project Zomboid Server Port
  adminRoleIds     String[] @default([]) // Roles authorized to use admin commands
  updateMentionIds String[] @default([]) // Roles/Users to ping on workshop update

  ModWatchlist     ModWatchlist[]
  TicketSettings   TicketSettings?
  CustomEmbed      CustomEmbed[]
  CustomCommand    CustomCommand[]
  KnowledgeSnippet KnowledgeSnippet[]
}

model ModWatchlist {
  id          String      @id @default(cuid())
  guildId     String
  workshopId  String
  title       String? // Store the workshop item title
  lastUpdated DateTime    @default(now())
  guild       GuildConfig @relation(fields: [guildId], references: [guildId])

  @@unique([guildId, workshopId])
}

model TicketSettings {
  id                   String           @id @default(cuid())
  guildId              String           @unique
  ticketPanelMessageId String?
  welcomeMessage       String           @default("Hello! Please describe your issue.")
  ticketPanelMessage   String           @default("Click the button below to open a new support ticket.") // New field
  guild                GuildConfig      @relation(fields: [guildId], references: [guildId])
  categories           TicketCategory[]
  tickets              Ticket[]
}

model TicketCategory {
  id               String         @id @default(cuid())
  ticketSettingsId String
  name             String
  emoji            String?
  roleId           String? // Role to ping
  ticketSettings   TicketSettings @relation(fields: [ticketSettingsId], references: [id])
}

model Ticket {
  id               String         @id @default(cuid())
  ticketSettingsId String
  userId           String
  channelId        String         @unique // Discord channel ID for the ticket
  status           TicketStatus   @default(OPEN)
  createdAt        DateTime       @default(now())
  closedAt         DateTime?
  ticketSettings   TicketSettings @relation(fields: [ticketSettingsId], references: [id])
}

enum TicketStatus {
  OPEN
  CLOSED
  ARCHIVED
}

model CustomEmbed {

  id        String    @id @default(cuid())

  guildId   String

  name      String    @unique

  data      Json      // Store the embed JSON

  createdAt DateTime  @default(now())

  updatedAt DateTime  @updatedAt

  guild     GuildConfig @relation(fields: [guildId], references: [guildId])

  commands  CustomCommand[]

}



model CustomCommand {

  id            String      @id @default(cuid())

  guildId       String

  name          String

  description   String      @default("A custom server command.")

  embedId       String

  embed         CustomEmbed @relation(fields: [embedId], references: [id], onDelete: Cascade)

  guild         GuildConfig @relation(fields: [guildId], references: [guildId])



  @@unique([guildId, name])

}



model KnowledgeSnippet {

  id        String    @id @default(cuid())

  guildId   String

  question  String

  answer    String

  source    String?   // e.g., "user_contribution", "admin_doc"

  verified  Boolean   @default(false)

  createdAt DateTime  @default(now())

  updatedAt DateTime  @updatedAt

  guild     GuildConfig @relation(fields: [guildId], references: [guildId])

}
